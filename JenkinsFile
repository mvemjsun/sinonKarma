
def y

pipeline {
    agent any
    stages {
        stage('Dependencies') {
            steps {
                echo "Building in workspace ${WORKSPACE} ${GIT_BRANCH}"
                sh 'npm ci'
            }
        }

        stage("Lint+Test") {
            stages {
                    stage('Lint') {
                        steps {
                            milestone label: 'Reached Test Milestone', ordinal: 1
                            echo 'Parallel: Linting'
                            script {
                                def myProc = load './scripts/echoData.groovy'
                                myProc.showBranchName()
                                myProc.showParams("Hola")
                                def x = myProc.returnValue()
                                y = x
                                myProc.importTest()
                                def ids = myProc.ids
                                echo "Ids are ${ids}"
                                echo "Return value is ${ids} size is ${ids.size()} first ${ids[0]} "
                            }
                        }
                    }

                    stage('Test') {
                        steps {
                            echo 'Parallel: Testing'
                            sh 'npm run test'
                            echo "Value of y is ${y}"
                            // echo "Value of x is ${x}" // Not accessible
                        }
                    }
            }
        }
    }
}